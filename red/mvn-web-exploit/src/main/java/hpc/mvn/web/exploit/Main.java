package hpc.mvn.web.exploit;
//----------
import com.sun.net.httpserver.Headers;
import org.apache.logging.log4j.Logger;
import org.apache.logging.log4j.LogManager;
import java.io.IOException;
import java.io.OutputStream;
import java.net.InetSocketAddress;
import com.sun.net.httpserver.HttpExchange;
import com.sun.net.httpserver.HttpHandler;
import com.sun.net.httpserver.HttpServer;
/**
 *
 * @author	Muhammad Nur Irsyad
 * @id		1807422020
 * @class	CCIT SEC 8 (TMJ)
 */
public class Main {
	private static final Logger logger = LogManager.getLogger(Main.class);
	//----------	
	public static void main (String[] args) throws Exception {
		System.setProperty("com.sun.jndi.ldap.object.trustURLCodebase", "true");
		System.setProperty("com.sun.jndi.cosnaming.object.trustURLCodebase", "true");   		
		//----------			
        HttpServer server = HttpServer.create(new InetSocketAddress(4080), 0);
        server.createContext("/", new ExploitHandler());
        server.setExecutor(null);
        server.start();
		logger.debug("starting log4hshell http server at :4080 ...");		
	}
	
	static class ExploitHandler implements HttpHandler {
		@Override
		public void handle(HttpExchange t) throws IOException {
			Headers payload = t.getRequestHeaders();
			String response = "you got pwnd!\n";				
			logger.info	(payload.getFirst("Payload"));		
			//----------						
			t.sendResponseHeaders(200, response.length());
			OutputStream os = t.getResponseBody();
			os.write(response.getBytes());
			os.close();
		}
	}	
}
